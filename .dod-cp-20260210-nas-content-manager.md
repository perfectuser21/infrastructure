# Definition of Done: NAS 内容管理工具脚本

## 功能完整性

- [ ] **list 命令** - 列出所有内容，输出格式正确
  - Test: `./nas-content-manager.sh list` 输出包含 content_id | status | type | title

- [ ] **show 命令** - 显示内容详情
  - Test: `./nas-content-manager.sh show <existing_content_id>` 输出 manifest + 文件列表

- [ ] **read 命令** - 读取文本内容
  - Test: `./nas-content-manager.sh read <existing_content_id>` 输出 markdown 内容

- [ ] **update-text 命令** - 更新文本
  - Test: 创建测试文件，上传后验证 NAS 上文件存在且 manifest 更新

- [ ] **update-status 命令** - 更新状态
  - Test: 更新状态后验证 manifest.json 的 status.state 和 updated_at 变化

- [ ] **add-platform 命令** - 添加平台
  - Test: 添加平台后验证 manifest.json 的 platforms 数组包含新平台

- [ ] **upload-image 命令** - 上传图片
  - Test: 上传图片后验证文件存在且 manifest.json 的 assets.images 更新

- [ ] **search 命令** - 搜索内容
  - Test: 搜索关键词后验证输出包含匹配的内容

- [ ] **filter 命令** - 按状态筛选
  - Test: 筛选 draft 状态后验证输出只包含 draft 内容

- [ ] **stats 命令** - 统计信息
  - Test: 运行 stats 后验证输出包含总数、类型统计、状态统计

- [ ] **create 命令** - 创建新内容
  - Test: 创建新内容后验证目录结构和 manifest.json 正确

- [ ] **help 命令** - 显示帮助
  - Test: 运行 help 后验证输出包含所有命令说明

## 错误处理

- [ ] **不存在的 content_id** - 返回错误并退出码 1
  - Test: `./nas-content-manager.sh show non-existent-id` 返回错误

- [ ] **无效参数** - 返回错误并显示用法
  - Test: `./nas-content-manager.sh update-status` (缺少参数) 返回错误

- [ ] **文件不存在** - 上传/读取不存在的文件时返回错误
  - Test: `./nas-content-manager.sh update-text <id> /nonexistent/file` 返回错误

## 输出格式

- [ ] **颜色输出** - INFO/WARN/ERROR 使用不同颜色
  - Test: 目视检查各类日志输出颜色正确

- [ ] **JSON 格式化** - manifest.json 输出使用 jq 格式化
  - Test: show 命令输出的 JSON 格式正确且易读

## 原子操作

- [ ] **文件上传** - 先上传到 /tmp/ 再 mv
  - Test: 检查脚本代码使用临时文件

- [ ] **Manifest 更新** - 使用 jq + 临时文件
  - Test: 检查脚本代码使用 jq 和临时文件更新 manifest

## 可调用性

- [ ] **退出码** - 成功返回 0，失败返回 1
  - Test: 验证各种成功/失败场景的退出码

- [ ] **错误输出到 stderr** - 错误信息不输出到 stdout
  - Test: `./nas-content-manager.sh show non-existent 2>&1 >/dev/null` 仍有输出

## 文档

- [ ] **README 更新** - 在 infrastructure/README.md 中添加工具说明
  - Test: README 包含工具用法和示例

## 集成测试

- [ ] **手动测试** - 在实际 NAS 上测试所有命令
  - Test: 创建、更新、查询、删除一个测试内容的完整流程

## CI 检查

- [ ] **脚本语法** - shellcheck 通过
  - Test: `shellcheck scripts/nas-content-manager.sh` 无错误

- [ ] **执行权限** - 脚本有执行权限
  - Test: `test -x scripts/nas-content-manager.sh`

## 非功能需求

- [ ] **性能** - list 命令在 5 秒内完成（假设 200 个内容）
  - Test: `time ./nas-content-manager.sh list`

- [ ] **依赖检查** - 脚本开始时检查 jq 是否安装
  - Test: 在没有 jq 的环境运行脚本返回明确错误

## 安全性

- [ ] **无明文密码** - 脚本中无硬编码密码
  - Test: grep password 脚本文件无结果

- [ ] **SSH 密钥** - 使用现有 SSH 配置，不创建新密钥
  - Test: 检查脚本只使用 ssh 命令，不操作密钥文件
