---
id: prd-nas-sync-fix
version: 1.0.0
created: 2026-02-12
changelog:
  - 1.0.0: 初始版本 - 修复 NAS 同步脚本配置
---

## PRD - NAS 同步脚本配置修复

**需求来源**: 实际测试发现默认配置不正确

**问题**:
1. 默认 NAS_PATH=/volume1/backups/us-vps 无权限访问
2. 默认 NAS_USER=xx 用户名错误（应为 徐啸）
3. rsync 命令缺少 --rsync-path 参数导致连接失败

**解决方案**:
1. 更新默认 NAS_PATH 为相对路径 `backups/us-vps`
2. 更新默认 NAS_USER 为 `徐啸`
3. rsync 命令添加 `--rsync-path=/usr/bin/rsync`
4. rsync 命令添加 `-o StrictHostKeyChecking=no`

**测试验证**:
- 已测试 infrastructure 同步（232KB，40文件）
- 已测试 cecelia-core 同步（6.8MB）
- 确认相对路径和正确用户名可以工作

**涉及文件**:
- `scripts/sync-to-nas.sh` - 更新默认配置和 rsync 命令
- `scripts/test-sync-to-nas.sh` - 新建测试脚本（自动化测试）

**成功标准**:
1. 脚本使用默认配置可以成功同步
2. 测试脚本验证所有功能
3. 文档更新反映实际配置
