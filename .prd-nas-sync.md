---
id: prd-nas-sync
version: 1.0.0
created: 2026-02-12
changelog:
  - 1.0.0: 初始版本 - NAS 自动同步配置
---

## PRD - NAS 自动同步配置

**需求来源**: 用户反馈 - "NAS是在西安呀。但是你跟美国是怎么样同步的呀，应该自动同步呀，对不对"

**功能描述**:
配置美国 VPS (146.190.52.84) 与 NAS (100.110.241.76, Xi'an) 之间的自动同步机制。

**背景**:
- 现状：美国 VPS → 香港 VPS 已有自动同步（每小时 rsync）
- 缺失：美国 VPS → NAS 没有自动同步
- NAS 位置：西安，通过 Tailscale 连接（100.110.241.76, hostname: zenithjoy-nas）

**涉及文件**:
- `scripts/sync-to-nas.sh` - NAS 同步脚本（新建）
- `docs/nas/sync-configuration.md` - 同步配置文档（新建）
- `README.md` - 更新同步架构说明（如需要）

**成功标准**:
1. 创建 sync-to-nas.sh 脚本，支持手动和自动同步
2. 脚本包含以下功能：
   - 健康检查（NAS 可达性）
   - rsync 同步（通过 Tailscale）
   - 错误处理和日志记录
   - 同步验证
3. 文档说明：
   - 如何配置 SSH 密钥认证
   - Cron 定时任务示例
   - 故障排查步骤
4. 向后兼容：不影响现有 US → HK 同步

**非目标**:
- 不包含 NAS SSH 密钥配置（需要用户手动配置）
- 不安装 cifs-utils（因为无 sudo 权限）
- 不修改现有 US → HK 同步脚本

**技术方案**:
```bash
# sync-to-nas.sh 脚本结构
1. 检查 Tailscale 连接到 NAS
2. 使用 rsync over SSH 同步
3. 支持过滤器（排除不需要同步的文件）
4. 记录同步日志到 /var/log/nas-sync.log
5. 失败时发送通知（可选）
```

**依赖**:
- Tailscale 已连接（✅ 已确认可达）
- NAS SSH 访问（❓ 需要用户提供密钥或配置密钥认证）
- rsync 已安装（✅ 通常预装）

**验证步骤**:
1. 手动运行脚本测试连接性
2. 验证同步的文件列表
3. 检查日志输出
4. 配置 cron 定时任务（文档化步骤）
