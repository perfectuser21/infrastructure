---
id: network-topology
version: 1.0.0
created: 2026-02-10
changelog:
  - 1.0.0: åˆå§‹ç‰ˆæœ¬ - ä»å…¨å±€ CLAUDE.md è¿ç§»
---

# ç½‘ç»œæ‹“æ‰‘ - Perfect21 ç”Ÿæ€ç³»ç»Ÿ

## ğŸŒ å®Œæ•´ç½‘ç»œæ‹“æ‰‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ· Mac (ä¸­å›½)                                             â”‚
â”‚  â”œâ”€â”€ WARP (Include æ¨¡å¼) â†’ åªç®¡ç¾å›½ VPS è¿æ¥                  â”‚
â”‚  â”œâ”€â”€ Clash (X-Ray) â†’ ç¿»å¢™æµé‡ï¼Œèµ° VPS å¹²å‡€å‡ºå£                â”‚
â”‚  â””â”€â”€ Tailscale â†’ å†…ç½‘ç©¿é€                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‡ºğŸ‡¸ ç¾å›½ VPS (ç ”å‘)    â”‚  â—„â”€Tailscaleâ”€â–º â”‚  ğŸ‡­ğŸ‡° é¦™æ¸¯ VPS (ç”Ÿäº§)    â”‚
â”‚  146.190.52.84        â”‚                 â”‚  43.154.85.217        â”‚
â”‚  Tailscale: 100.71.32.28               â”‚  Tailscale: 100.86.118.99
â”‚                       â”‚                 â”‚                       â”‚
â”‚  æœåŠ¡:                â”‚                 â”‚  æœåŠ¡:                â”‚
â”‚  - Claude Code (æœ‰å¤´) â”‚                 â”‚  - X-Ray VPN (:443)   â”‚
â”‚  - X-Ray VPN (:443)   â”‚                 â”‚  - è®¢é˜…æœåŠ¡å™¨ (:8080) â”‚
â”‚  - Cecelia Brain      â”‚                 â”‚  - PostgreSQL (:5432) â”‚
â”‚  - å‰ç«¯å¼€å‘ç¯å¢ƒ       â”‚                 â”‚  - ç”Ÿäº§å‰ç«¯           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ (Tailscale)
                          â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  ğŸ¢ è¥¿å®‰å…¬å¸            â”‚
                â”‚                       â”‚
                â”‚  è®¾å¤‡:                â”‚
                â”‚  - NAS (æ–‡ä»¶å­˜å‚¨)      â”‚
                â”‚    - Tailscale: TBD  â”‚
                â”‚  - Mac mini          â”‚
                â”‚    - Tailscale: 100.86.57.69
                â”‚  - Node PC           â”‚
                â”‚    - Tailscale: 100.97.242.124
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ–¥ï¸ æœåŠ¡å™¨æ¸…å•

| æœåŠ¡å™¨ | IP | Tailscale IP | ä½ç½® | ç”¨é€” |
|--------|-------|--------------|------|------|
| ğŸ‡ºğŸ‡¸ ç¾å›½ VPS | 146.190.52.84 | 100.71.32.28 | DigitalOcean NYC | ç ”å‘ç¯å¢ƒ |
| ğŸ‡­ğŸ‡° é¦™æ¸¯ VPS (ç”Ÿäº§) | 43.154.85.217 | 100.86.118.99 | è…¾è®¯äº‘ | ç”Ÿäº§ç¯å¢ƒ |
| ğŸ‡­ğŸ‡° é¦™æ¸¯ VPS (å¼€å‘) | - | 100.86.118.99 | è…¾è®¯äº‘ | å¼€å‘ç¯å¢ƒ |

## ğŸ’» è®¾å¤‡æ¸…å•

| è®¾å¤‡ | Tailscale IP | ä½ç½® | ç”¨é€” |
|------|--------------|------|------|
| Mac mini | 100.86.57.69 | è¥¿å®‰å…¬å¸ | å¼€å‘è®¾å¤‡ |
| Node PC | 100.97.242.124 | è¥¿å®‰å…¬å¸ | è®¡ç®—è®¾å¤‡ |
| NAS | TBD | è¥¿å®‰å…¬å¸ | æ–‡ä»¶å­˜å‚¨ |
| ç”¨æˆ· Mac | åŠ¨æ€ | ä¸­å›½/ç§»åŠ¨ | ä¸»åŠ›å¼€å‘æœº |

## ğŸ”Œ è¿æ¥æ–¹å¼

| è¿æ¥ | æ–¹å¼ | è¯´æ˜ |
|------|------|------|
| Mac â†’ ç¾å›½ VPS | WARP + SSH | VSCode Remoteï¼ŒWARP åŠ é€Ÿ |
| Mac â†’ é¦™æ¸¯ VPS | ç›´è¿ | ä¸­å›½åˆ°é¦™æ¸¯å»¶è¿Ÿä½ï¼Œä¸éœ€è¦ WARP |
| ç¾å›½ â†’ é¦™æ¸¯ | Tailscale | å†…ç½‘ç©¿é€ï¼Œ`ssh hk` èµ° 100.86.118.99 |
| ç¾å›½ â†’ è¥¿å®‰è®¾å¤‡ | Tailscale | Mac mini/Node PC/NAS |
| ç¿»å¢™æµé‡ | Clash â†’ VPS | ChatGPT ç­‰èµ° X-Rayï¼Œå¹²å‡€å‡ºå£ |

## ğŸ›¡ï¸ Cloudflare WARP é…ç½®

**æ¨¡å¼**: Includeï¼ˆåªä»£ç†åˆ—è¡¨å†…çš„ IPï¼‰

```json
{
  "mode": "warp",
  "include": [
    {"address": "146.190.52.84/32", "description": "US VPS"}
  ]
}
```

**API ç®¡ç†**:
```bash
# æŸ¥çœ‹é…ç½®
source ~/.credentials/cloudflare.env
curl -s "https://api.cloudflare.com/client/v4/accounts/$CLOUDFLARE_ACCOUNT_ID/devices/policy" \
  -H "Authorization: Bearer $CLOUDFLARE_API_TOKEN"

# ä¿®æ”¹ Include åˆ—è¡¨
curl -s -X PATCH "https://api.cloudflare.com/client/v4/accounts/$CLOUDFLARE_ACCOUNT_ID/devices/policy" \
  -H "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"include": [{"address":"146.190.52.84/32"}]}'
```

## ğŸ” X-Ray VPN æœåŠ¡

| æœåŠ¡å™¨ | è®¢é˜…åœ°å€ | è´¦å·æ•° |
|--------|----------|--------|
| ğŸ‡ºğŸ‡¸ ç¾å›½ | `http://146.190.52.84:8080/clash/<uuid>` | 10 ä¸ª |
| ğŸ‡­ğŸ‡° é¦™æ¸¯ | `http://43.154.85.217:8080/clash/<uuid>` | 5 ä¸ª |

**é…ç½®æ–‡ä»¶**:
- ç¾å›½: `/opt/vpn/features/xray-reality/config/xray-server.json`
- é¦™æ¸¯: `/opt/xray-reality/config.json`

## ğŸŒ Cloudflare Tunnel åŸŸåè·¯ç”±

**Autopilot (ZenithJoy)** é€šè¿‡ Cloudflare Tunnel è®¿é—®ï¼Œ**ä¸å ç”¨ 443 ç«¯å£**ï¼š

| ç¯å¢ƒ | åŸŸå | æœåŠ¡å™¨ | ç«¯å£ |
|------|------|--------|------|
| ç”Ÿäº§ | autopilot.zenjoymedia.media | é¦™æ¸¯ VPS (43.154.85.217) | 5211 |
| ç”Ÿäº§ | zenjoymedia.media | é¦™æ¸¯ VPS (43.154.85.217) | 5211 |
| ç”Ÿäº§ | dashboard.zenjoymedia.media | é¦™æ¸¯ VPS (43.154.85.217) | 5211 |
| å¼€å‘ | dev-autopilot.zenjoymedia.media | é¦™æ¸¯ VPS (100.86.118.99) | 5212 |
| - | n8n.zenjoymedia.media | ç¾å›½ VPS (localhost) | 5679 |

Tunnel å®¹å™¨ï¼š`cloudflared-tunnel` (ç¾å›½ VPS)

**Cecelia** æ— å…¬ç½‘åŸŸåï¼Œä»…æœ¬åœ°è®¿é—®ï¼š
- æ­£å¼ç‰ˆï¼šhttp://perfect21:5211
- ç ”å‘ç‰ˆï¼šhttp://perfect21:5212

## ğŸ”’ 443 ç«¯å£å…±ç”¨æ¶æ„

```
443 ç«¯å£åŒæ—¶æœåŠ¡ VPN å’Œç½‘ç«™ï¼š

VPN è®¿é—®ï¼š  å®¢æˆ·ç«¯ â†’ IP:443 ç›´è¿ â†’ xray-reality
ç½‘ç«™è®¿é—®ï¼š  æµè§ˆå™¨ â†’ åŸŸå â†’ Cloudflare Tunnel â†’ localhost:ç«¯å£
                    ï¼ˆä¸ç»è¿‡ 443ï¼Œèµ° Cloudflare ç½‘ç»œï¼‰
```

## ğŸ“Š ç«¯å£ç¦åŒº

| ç«¯å£ | å ç”¨è€… | è¯´æ˜ |
|------|--------|------|
| 443 | VPN (xray-reality) | ç»å¯¹ä¸è¦åŠ¨ï¼ŒVPN ä¸“ç”¨ |
| 80, 81 | Nginx Proxy Manager | å†…éƒ¨ç®¡ç†ï¼Œä¸å¯¹å¤– |
| 3456, 5173 | Claude Monitor | ç›‘æ§æœåŠ¡ |

## ğŸ”„ ä¸‰ç½‘å…±å­˜è§„åˆ™

```
WARP (Include æ¨¡å¼)
â””â”€â”€ åªç®¡: 146.190.52.84 (ç¾å›½ VPS)
â””â”€â”€ å…¶ä»–æµé‡å®Œå…¨ä¸ç¢°

Tailscale
â””â”€â”€ åªç®¡: 100.x.x.x å†…ç½‘
â””â”€â”€ ä¸åœ¨ WARP Include é‡Œï¼Œä¸å†²çª âœ…

Clash (X-Ray)
â””â”€â”€ åªç®¡: ç¿»å¢™æµé‡
â””â”€â”€ ä¸åœ¨ WARP Include é‡Œï¼Œä¸å†²çª âœ…
```

**é‡è¦**: WARP å¿…é¡»ç”¨ Include æ¨¡å¼ï¼ŒExclude æ¨¡å¼ä¼šæŠ¢å  Clash æµé‡å¯¼è‡´å†²çªã€‚

## ğŸ“‹ SSH åˆ«åé…ç½®

```bash
# ~/.ssh/config
Host us
    HostName 146.190.52.84
    User root

Host hk
    HostName 100.86.118.99  # é€šè¿‡ Tailscale
    User root

Host hk-direct
    HostName 43.154.85.217
    User root
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- ç«¯å£æ˜ å°„: [ports.md](./ports.md)
- VPN é…ç½®: [vpn.md](./vpn.md)
- NAS é…ç½®: [../nas/setup.md](../nas/setup.md)
- æœåŠ¡å™¨è¯¦æƒ…: [../servers/](../servers/)
